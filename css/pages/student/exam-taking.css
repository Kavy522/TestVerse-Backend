/* ================================================================
   EXAM-TAKING PAGE — TestVerse
   ================================================================ */

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    background: #f8fafc;
    color: #1e293b;
    height: 100vh;
    overflow: hidden;
}

/* ── Utilities ──────────────────────────────────────────────────────── */
.hidden { display: none !important; }
.btn {
    display: inline-flex; align-items: center; gap: 0.4rem;
    padding: 0.55rem 1.1rem; border-radius: 8px;
    font-size: 0.875rem; font-weight: 600;
    cursor: pointer; border: none; transition: all 0.18s;
    text-decoration: none; white-space: nowrap; font-family: inherit;
}
.btn-primary  { background:#6366f1; color:#fff; box-shadow:0 2px 8px rgba(99,102,241,.3); }
.btn-primary:hover { background:#4f46e5; transform:translateY(-1px); }
.btn-outline  { background:#fff; color:#6366f1; border:1.5px solid #6366f1; }
.btn-outline:hover  { background:#6366f1; color:#fff; }
.btn-submit   { background: linear-gradient(135deg,#6366f1,#4f46e5); color:#fff; box-shadow:0 2px 10px rgba(99,102,241,.35); }
.btn-submit:hover { background: linear-gradient(135deg,#4f46e5,#4338ca); transform:translateY(-1px); }
.btn-sm { padding:0.375rem 0.8rem; font-size:0.8125rem; }
.btn:disabled { opacity:.45; cursor:not-allowed; transform:none !important; }

/* ── Fatal Overlay ──────────────────────────────────────────────────── */
.fatal-overlay {
    position:fixed; inset:0; background:#f8fafc;
    display:flex; align-items:center; justify-content:center; z-index:9999;
}
.fatal-box {
    background:#fff; border:1px solid #e2e8f0; border-radius:16px;
    padding:2.5rem; text-align:center; max-width:420px; width:100%;
    box-shadow:0 8px 30px rgba(15,23,42,.1);
}
.fatal-box i { font-size:3rem; color:#ef4444; margin-bottom:1rem; display:block; }
.fatal-box h2 { font-size:1.25rem; font-weight:700; color:#1e293b; margin-bottom:.5rem; }
.fatal-box p  { font-size:0.875rem; color:#64748b; margin-bottom:1.5rem; }

/* ── Submit Overlay ─────────────────────────────────────────────────── */
.submit-overlay {
    position:fixed; inset:0;
    background:rgba(15,23,42,.6); backdrop-filter:blur(4px);
    display:flex; align-items:center; justify-content:center; z-index:9000;
}
.submit-box {
    background:#fff; border-radius:16px; padding:2.5rem 3rem; text-align:center;
    box-shadow:0 20px 40px rgba(15,23,42,.2);
    display:flex; flex-direction:column; align-items:center; gap:1.25rem;
}
.submit-spinner {
    width:48px; height:48px;
    border:4px solid #e2e8f0; border-top-color:#6366f1;
    border-radius:50%; animation:spin .7s linear infinite;
}
.submit-box p { font-size:1rem; font-weight:600; color:#1e293b; }
@keyframes spin { to { transform:rotate(360deg); } }

/* ── Confirm Modal ──────────────────────────────────────────────────── */
.tv-modal {
    display:none; position:fixed; inset:0;
    background:rgba(15,23,42,.45); backdrop-filter:blur(2px);
    z-index:800; align-items:center; justify-content:center; padding:1rem;
}
.tv-modal.open { display:flex; }
.tv-modal-dialog {
    background:#fff; border-radius:16px;
    box-shadow:0 20px 40px rgba(15,23,42,.15);
    width:100%; max-height:90vh; overflow-y:auto;
    display:flex; flex-direction:column; animation:modalIn .2s ease;
}
@keyframes modalIn { from{opacity:0;transform:translateY(-10px) scale(.98)} to{opacity:1;transform:none} }
.tv-modal-sm { max-width:440px; }
.tv-modal-header {
    display:flex; align-items:center; justify-content:space-between;
    padding:1.125rem 1.5rem; border-bottom:1px solid #e2e8f0;
}
.tv-modal-title { font-size:.9375rem; font-weight:700; color:#1e293b; display:flex; align-items:center; gap:.45rem; margin:0; }
.tv-modal-title i { color:#6366f1; }
.tv-modal-close {
    width:28px; height:28px; border:none; background:#f8fafc;
    border-radius:6px; cursor:pointer; color:#64748b; font-size:.8rem;
    display:flex; align-items:center; justify-content:center; transition:.15s;
}
.tv-modal-close:hover { background:#fee2e2; color:#ef4444; }
.tv-modal-body { padding:1.375rem 1.5rem; }
.tv-modal-footer {
    padding:.875rem 1.5rem; border-top:1px solid #e2e8f0;
    display:flex; justify-content:flex-end; gap:.5rem;
}
.confirm-stats { display:flex; gap:1rem; justify-content:center; margin-bottom:1.125rem; }
.cs-item {
    display:flex; flex-direction:column; align-items:center; gap:.3rem;
    background:#f8fafc; border:1px solid #e2e8f0; border-radius:12px;
    padding:.875rem 1.25rem; min-width:90px;
}
.cs-item .cs-icon { font-size:1.25rem; }
.cs-icon.answered   { color:#22c55e; }
.cs-icon.unanswered { color:#94a3b8; }
.cs-icon.flagged    { color:#f59e0b; }
.cs-item span { font-size:1.5rem; font-weight:800; color:#1e293b; }
.cs-item label { font-size:.72rem; font-weight:600; color:#64748b; text-transform:uppercase; letter-spacing:.04em; }
.confirm-warn {
    display:flex; align-items:center; gap:.5rem;
    font-size:.8125rem; color:#d97706;
    background:rgba(245,158,11,.08); border:1px solid rgba(245,158,11,.2);
    padding:.625rem .875rem; border-radius:8px; margin-top:.25rem;
}
.confirm-warn i { flex-shrink:0; }

/* ── Time Warning Toast ─────────────────────────────────────────────── */
.time-toast {
    position:fixed; top:80px; right:1.25rem; z-index:700;
    background:#fef3c7; border:1.5px solid #f59e0b; border-radius:10px;
    padding:.75rem 1rem; display:flex; align-items:center; gap:.625rem;
    font-size:.875rem; font-weight:600; color:#92400e;
    box-shadow:0 4px 16px rgba(245,158,11,.2); animation:slideInRight .3s ease;
}
.time-toast.urgent { background:#fef2f2; border-color:#ef4444; color:#b91c1c; }
.time-toast button { background:none; border:none; cursor:pointer; color:inherit; margin-left:.25rem; }
@keyframes slideInRight { from{opacity:0;transform:translateX(20px)} to{opacity:1;transform:none} }

/* ── Save Toast ─────────────────────────────────────────────────────── */
.save-toast {
    position:fixed; bottom:1.5rem; right:1.5rem; z-index:700;
    background:#f0fdf4; border:1px solid #bbf7d0; border-radius:8px;
    padding:.5rem 1rem; display:flex; align-items:center; gap:.5rem;
    font-size:.8125rem; font-weight:600; color:#166534;
    box-shadow:0 4px 12px rgba(34,197,94,.15); animation:fadeUp .25s ease;
}
@keyframes fadeUp { from{opacity:0;transform:translateY(8px)} to{opacity:1;transform:none} }

/* ── Offline Banner ─────────────────────────────────────────────────── */
.offline-banner {
    position:fixed; top:0; left:0; right:0; z-index:600;
    background:#fef2f2; border-bottom:2px solid #fecaca;
    padding:.5rem 1.5rem; display:flex; align-items:center; gap:.625rem;
    font-size:.8125rem; font-weight:600; color:#b91c1c; animation:slideDown .3s ease;
}
@keyframes slideDown { from{transform:translateY(-100%)} to{transform:none} }

/* ══════════════════════════════════════════════════════════════════
   EXAM SHELL
══════════════════════════════════════════════════════════════════ */
.exam-shell { display:flex; flex-direction:column; height:100vh; overflow:hidden; }

/* ── Topbar ─────────────────────────────────────────────────────────── */
.exam-topbar {
    height:62px; background:#ffffff; border-bottom:1px solid #e2e8f0;
    display:flex; align-items:center; padding:0 1.25rem 0 1rem;
    gap:1rem; flex-shrink:0; z-index:100; position:relative;
}
.et-left  { display:flex; align-items:center; gap:.875rem; flex:1; min-width:0; }
.et-center{ position:absolute; left:50%; transform:translateX(-50%); }
.et-right { display:flex; align-items:center; gap:.875rem; flex:1; justify-content:flex-end; }
.et-logo { display:flex; align-items:center; gap:.5rem; font-size:1.1rem; font-weight:700; color:#6366f1; flex-shrink:0; }
.et-logo i { font-size:1.25rem; }
.et-exam-info { display:flex; flex-direction:column; min-width:0; }
.et-exam-title {
    font-size:.9rem; font-weight:700; color:#1e293b;
    white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:280px;
}
.et-exam-type { font-size:.7rem; font-weight:600; color:#6366f1; text-transform:uppercase; letter-spacing:.05em; }

/* Timer */
.exam-timer-wrap {
    display:flex; align-items:center; gap:.5rem;
    padding:.4rem 1rem; border-radius:9999px;
    background:#f8fafc; border:1.5px solid #e2e8f0; transition:background .3s, border-color .3s;
}
.exam-timer-wrap i { color:#6366f1; font-size:.9rem; }
.exam-timer {
    font-size:1.125rem; font-weight:900; color:#1e293b;
    font-family:'Fira Code','Monaco',ui-monospace,monospace;
    font-variant-numeric:tabular-nums; letter-spacing:.02em;
    min-width:70px; text-align:center;
}
.timer-label { font-size:.7rem; font-weight:500; color:#94a3b8; }
.exam-timer-wrap.warn   { background:#fef3c7; border-color:#f59e0b; }
.exam-timer-wrap.warn   .exam-timer { color:#d97706; }
.exam-timer-wrap.warn   i { color:#d97706; }
.exam-timer-wrap.danger { background:#fef2f2; border-color:#ef4444; animation:timerPulse .8s ease-in-out infinite; }
.exam-timer-wrap.danger .exam-timer { color:#ef4444; }
.exam-timer-wrap.danger i { color:#ef4444; }
@keyframes timerPulse { 0%,100%{box-shadow:0 0 0 0 rgba(239,68,68,.3)} 50%{box-shadow:0 0 0 6px rgba(239,68,68,0)} }

/* Save status */
.et-save-status { display:flex; align-items:center; gap:.375rem; font-size:.75rem; font-weight:600; color:#94a3b8; transition:color .3s; }
.et-save-status i { font-size:.8rem; }
.et-save-status.saved  { color:#16a34a; }
.et-save-status.saving { color:#6366f1; }
.et-save-status.failed { color:#ef4444; }
.et-save-status.local  { color:#d97706; }

/* ── Exam Body ──────────────────────────────────────────────────────── */
.exam-body { display:flex; flex:1; overflow:hidden; }

/* ══ QUESTION NAVIGATOR ════════════════════════════════════════════════ */
.qnav-sidebar {
    width:220px; flex-shrink:0;
    background:#ffffff; border-right:1px solid #e2e8f0;
    display:flex; flex-direction:column;
    overflow-y:auto; padding:1rem; gap:.875rem;
}
.qnav-progress { display:flex; flex-direction:column; gap:.35rem; }
.qnav-prog-labels { display:flex; justify-content:space-between; font-size:.72rem; font-weight:600; color:#64748b; }
.qnav-prog-track { height:6px; background:#f1f5f9; border-radius:9999px; overflow:hidden; }
.qnav-prog-fill { height:100%; background:linear-gradient(90deg,#6366f1,#818cf8); border-radius:9999px; transition:width .4s ease; }
.qnav-legend { display:flex; flex-direction:column; gap:.3rem; }
.qnav-legend-item { display:flex; align-items:center; gap:.45rem; font-size:.7rem; font-weight:500; color:#64748b; }
.qn-bubble { width:14px; height:14px; border-radius:4px; flex-shrink:0; border:1.5px solid transparent; }
.qn-unanswered { background:#f1f5f9; border-color:#e2e8f0; }
.qn-answered   { background:#22c55e; border-color:#16a34a; }
.qn-current    { background:#6366f1; border-color:#4f46e5; }
.qn-flagged    { background:#f59e0b; border-color:#d97706; }
.qnav-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:.375rem; }
.qn-btn {
    aspect-ratio:1; border:1.5px solid #e2e8f0; background:#f8fafc; border-radius:6px;
    font-size:.75rem; font-weight:700; color:#64748b;
    cursor:pointer; display:flex; align-items:center; justify-content:center;
    position:relative; transition:all .15s;
}
.qn-btn:hover { border-color:#6366f1; color:#6366f1; }
.qn-btn.qn-answered  { background:#dcfce7; border-color:#22c55e; color:#15803d; }
.qn-btn.qn-current   { background:#6366f1; border-color:#4f46e5; color:#fff; box-shadow:0 2px 8px rgba(99,102,241,.4); }
.qn-btn.qn-flagged   { background:#fef3c7; border-color:#f59e0b; color:#92400e; }
.qn-btn.qn-flagged::after { content:'⚑'; position:absolute; top:-4px; right:-3px; font-size:.55rem; color:#f59e0b; line-height:1; }
.qn-btn.qn-flagged.qn-answered { background:linear-gradient(135deg,#dcfce7 50%,#fef3c7 50%); border-color:#f59e0b; color:#166534; }
.qnav-sections { display:flex; flex-direction:column; gap:.3rem; margin-top:auto; }
.qnav-section-btn {
    padding:.375rem .625rem; border-radius:6px; font-size:.72rem; font-weight:600; color:#64748b;
    background:none; border:1px solid #e2e8f0; cursor:pointer;
    text-align:left; transition:all .15s; font-family:inherit;
    white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}
.qnav-section-btn.active { background:#ede9fe; border-color:#6366f1; color:#6366f1; }
.qnav-section-btn:hover  { border-color:#6366f1; color:#6366f1; }

/* ══ QUESTION AREA ══════════════════════════════════════════════════════ */
.question-area {
    flex:1; overflow-y:auto; padding:1.5rem 2rem;
    display:flex; flex-direction:column; gap:1rem; background:#f8fafc;
}
.qa-loading {
    display:flex; flex-direction:column; align-items:center;
    justify-content:center; gap:.875rem; flex:1;
    color:#94a3b8; font-size:.875rem; padding:3rem;
}
.et-spinner {
    width:38px; height:38px; border:3px solid #e2e8f0; border-top-color:#6366f1;
    border-radius:50%; animation:spin .7s linear infinite;
}

/* ── Question Card ──────────────────────────────────────────────────── */
.question-card {
    background:#ffffff; border:1px solid #e2e8f0; border-radius:16px; overflow:hidden;
    box-shadow:0 2px 8px rgba(15,23,42,.05); display:flex; flex-direction:column; flex:1;
}
.qc-header {
    display:flex; align-items:center; justify-content:space-between;
    padding:.875rem 1.375rem; background:#fafafa; border-bottom:1px solid #f1f5f9;
    gap:.875rem; flex-wrap:wrap;
}
.qc-header-left  { display:flex; align-items:center; gap:.625rem; }
.qc-header-right { display:flex; align-items:center; gap:.625rem; }
.qc-num { font-size:.9375rem; font-weight:800; color:#6366f1; min-width:28px; }
.qc-type-badge {
    padding:.2rem .625rem; border-radius:9999px; font-size:.68rem; font-weight:700;
    text-transform:uppercase; letter-spacing:.05em;
    background:rgba(99,102,241,.08); color:#6366f1; border:1px solid rgba(99,102,241,.2);
}
.qc-marks { font-size:.78rem; font-weight:700; color:#64748b; background:#f1f5f9; padding:.2rem .5rem; border-radius:6px; }
.flag-btn {
    display:flex; align-items:center; gap:.35rem; padding:.3rem .75rem; border-radius:8px;
    border:1.5px solid #e2e8f0; background:#fff; font-size:.78rem; font-weight:600; color:#64748b;
    cursor:pointer; transition:all .15s; font-family:inherit;
}
.flag-btn:hover  { border-color:#f59e0b; color:#d97706; }
.flag-btn.flagged { background:#fef3c7; border-color:#f59e0b; color:#d97706; }
.flag-btn i { font-size:.8rem; }
.qc-section { font-size:.7rem; font-weight:600; color:#94a3b8; background:#f1f5f9; padding:.175rem .5rem; border-radius:6px; }

/* Q Body */
.qc-body { padding:1.375rem 1.5rem; border-bottom:1px solid #f1f5f9; }
.q-text { font-size:.9375rem; line-height:1.7; color:#1e293b; white-space:pre-wrap; word-break:break-word; }
.q-text code {
    background:#f1f5f9; padding:.1em .35em; border-radius:4px;
    font-family:'Fira Code','Monaco',ui-monospace,monospace; font-size:.875em; color:#4338ca;
}
.q-text pre {
    background:#1e293b; color:#e2e8f0; padding:1rem 1.125rem;
    border-radius:10px; overflow-x:auto; margin:.75rem 0;
    font-family:'Fira Code','Monaco',ui-monospace,monospace; font-size:.85rem; line-height:1.6;
}
.q-image-wrap { margin-top:1rem; }
.q-image { max-width:100%; max-height:320px; object-fit:contain; border-radius:10px; border:1px solid #e2e8f0; }

/* ── Answer Areas ───────────────────────────────────────────────────── */
.answer-area { padding:1.375rem 1.5rem; }

/* MCQ */
.mcq-options { display:flex; flex-direction:column; gap:.625rem; }
.mcq-option {
    display:flex; align-items:flex-start; gap:.875rem; padding:.875rem 1rem; border-radius:10px;
    border:1.5px solid #e2e8f0; background:#fafafa; cursor:pointer; transition:all .15s;
    font-size:.9rem; color:#1e293b; user-select:none;
}
.mcq-option:hover:not(.selected) { border-color:#a5b4fc; background:#f8f7ff; }
.mcq-option.selected { border-color:#6366f1; background:#eef2ff; box-shadow:0 0 0 3px rgba(99,102,241,.08); }
.mcq-option.selected .mcq-bullet { border-color:#6366f1; background:#6366f1; }
.mcq-bullet {
    width:18px; height:18px; border-radius:50%; border:2px solid #e2e8f0;
    flex-shrink:0; margin-top:1px; display:flex; align-items:center; justify-content:center; transition:all .15s;
}
.mcq-bullet.checked::after { content:''; width:8px; height:8px; background:#fff; border-radius:50%; }
.mcq-label-key { font-size:.72rem; font-weight:800; color:#6366f1; background:#ede9fe; padding:.15rem .45rem; border-radius:5px; flex-shrink:0; }
.mcq-label-text { flex:1; line-height:1.5; }
.multi-hint {
    font-size:.75rem; color:#64748b; background:#f8fafc; border:1px solid #e2e8f0;
    padding:.375rem .75rem; border-radius:6px; margin-bottom:.75rem;
    display:flex; align-items:center; gap:.375rem;
}
.multi-hint i { color:#6366f1; font-size:.7rem; }

/* True / False */
.tf-options { display:flex; gap:1rem; }
.tf-btn {
    flex:1; padding:1rem; border-radius:12px; border:2px solid #e2e8f0; background:#fafafa;
    font-size:1rem; font-weight:700; cursor:pointer; transition:all .15s; font-family:inherit;
    display:flex; align-items:center; justify-content:center; gap:.5rem;
}
.tf-btn[data-val="true"]:hover,
.tf-btn[data-val="true"].active  { border-color:#22c55e; background:#f0fdf4; color:#16a34a; }
.tf-btn[data-val="false"]:hover,
.tf-btn[data-val="false"].active { border-color:#ef4444; background:#fef2f2; color:#dc2626; }
.tf-btn.active { box-shadow:0 0 0 3px rgba(99,102,241,.1); }

/* Short Answer / Descriptive — FIX: proper footer wrapper */
.text-answer {
    width:100%; min-height:140px; resize:vertical;
    padding:.875rem 1rem; border:1.5px solid #e2e8f0; border-radius:10px;
    font-family:inherit; font-size:.9rem; color:#1e293b;
    background:#fff; line-height:1.6;
    transition:border-color .2s, box-shadow .2s; outline:none;
}
.text-answer:focus { border-color:#6366f1; box-shadow:0 0 0 3px rgba(99,102,241,.08); }
.text-answer-footer { display:flex; justify-content:flex-end; padding:.3rem 0 0; }
.text-char-count { font-size:.72rem; color:#94a3b8; }

/* Coding */
.code-header {
    display:flex; align-items:center; gap:.625rem;
    background:#1e293b; padding:.5rem .875rem;
    border-radius:10px 10px 0 0; border-bottom:1px solid #334155;
}
.code-lang-label { font-size:.75rem; font-weight:600; color:#94a3b8; white-space:nowrap; }
.code-lang-select { padding:.3rem .625rem; border-radius:6px; border:1px solid #334155; background:#0f172a; color:#e2e8f0; font-size:.8rem; font-family:inherit; cursor:pointer; }
.code-lang-select:focus { outline:none; border-color:#6366f1; }
.btn-reset-code {
    background:rgba(255,255,255,.07); border:1px solid #334155; color:#94a3b8;
    padding:.25rem .6rem; border-radius:6px; font-size:.72rem; cursor:pointer; font-family:inherit;
    display:flex; align-items:center; gap:.3rem; transition:.15s;
}
.btn-reset-code:hover { background:rgba(255,255,255,.12); color:#e2e8f0; }
.btn-fullscreen-code {
    background:rgba(255,255,255,.07); border:1px solid #334155; color:#94a3b8;
    padding:.25rem .55rem; border-radius:6px; font-size:.78rem; cursor:pointer;
    margin-left:auto; transition:.15s; display:flex; align-items:center;
}
.btn-fullscreen-code:hover { background:rgba(255,255,255,.12); color:#e2e8f0; }
.monaco-editor-wrap { height:340px; border:1px solid #334155; border-top:none; border-radius:0 0 10px 10px; overflow:hidden; }
.code-footer { display:flex; justify-content:space-between; align-items:center; padding:.375rem .875rem .25rem; font-size:.72rem; color:#94a3b8; }
.code-hint { display:flex; align-items:center; gap:.3rem; }
.code-hint i { color:#6366f1; font-size:.68rem; }
.code-saved { font-size:.7rem; color:#22c55e; font-weight:600; }

/* Q Footer */
.qc-footer {
    display:flex; align-items:center; justify-content:space-between;
    padding:.875rem 1.375rem; background:#fafafa; border-top:1px solid #f1f5f9; flex-shrink:0;
}
.qc-footer-left, .qc-footer-right { display:flex; align-items:center; gap:.625rem; }

/* ── Fullscreen Code Overlay ────────────────────────────────────────── */
.fs-code-overlay { position:fixed; inset:0; z-index:900; background:#0f172a; display:flex; flex-direction:column; }
.fs-code-header { display:flex; align-items:center; justify-content:space-between; padding:.625rem 1.25rem; background:#1e293b; border-bottom:1px solid #334155; }
.fs-code-header span { font-size:.875rem; font-weight:700; color:#e2e8f0; }
.fs-code-actions { display:flex; align-items:center; gap:.625rem; }
.fs-monaco-wrap { flex:1; overflow:hidden; }

/* ── Scrollbars ─────────────────────────────────────────────────────── */
::-webkit-scrollbar { width:5px; height:5px; }
::-webkit-scrollbar-track { background:#f8fafc; }
::-webkit-scrollbar-thumb { background:#e2e8f0; border-radius:9999px; }
::-webkit-scrollbar-thumb:hover { background:#cbd5e1; }

/* ── Responsive ─────────────────────────────────────────────────────── */
@media (max-width:900px) {
    .qnav-sidebar { width:180px; }
    .question-area { padding:1rem 1.25rem; }
    .et-exam-title { max-width:180px; }
    .timer-label { display:none; }
}
@media (max-width:680px) {
    .qnav-sidebar { display:none; }
    .exam-topbar { padding:0 .875rem; }
    .et-left { flex:none; }
    .et-exam-info { display:none; }
    .et-save-status { display:none; }
    .et-center { position:static; transform:none; }
    .question-area { padding:.875rem 1rem; }
    .mcq-option { padding:.75rem; }
    .tf-options { flex-direction:column; }
}
