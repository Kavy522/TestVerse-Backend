<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staff Dashboard â€” TestVerse</title>
    <link rel="icon" href="../../assets/icons/exam.svg" type="image/svg+xml">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../../css/core/reset.css">
    <link rel="stylesheet" href="../../css/core/variables.css">
    <link rel="stylesheet" href="../../css/core/typography.css">
    <link rel="stylesheet" href="../../css/core/layout.css">
    <link rel="stylesheet" href="../../css/components/buttons.css">
    <link rel="stylesheet" href="../../css/components/cards.css">
    <link rel="stylesheet" href="../../css/components/badges.css">
    <link rel="stylesheet" href="../../css/components/tables.css">
    <link rel="stylesheet" href="../../css/components/alerts.css">
    <link rel="stylesheet" href="../../css/pages/staff/dashboard.css">
</head>
<body class="dashboard-layout">

    <!-- â•â• SIDEBAR â•â• -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <i class="fas fa-graduation-cap"></i>
                <span class="logo-text">TestVerse</span>
            </div>
            <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle sidebar">
                <i class="fas fa-bars"></i>
            </button>
        </div>
        <nav class="sidebar-nav">
            <a href="dashboard.html" class="nav-item active"><i class="fas fa-home"></i><span>Dashboard</span></a>
            <a href="exams.html"     class="nav-item"><i class="fas fa-file-alt"></i><span>Exams</span></a>
            <a href="students.html"  class="nav-item"><i class="fas fa-users"></i><span>Students</span></a>
            <a href="results.html"   class="nav-item"><i class="fas fa-chart-bar"></i><span>Results</span></a>
            <a href="analytics.html" class="nav-item"><i class="fas fa-chart-line"></i><span>Analytics</span></a>
            <a href="settings.html"  class="nav-item"><i class="fas fa-cog"></i><span>Settings</span></a>
        </nav>
        <div class="sidebar-footer">
            <button class="nav-item logout-btn" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i><span>Logout</span>
            </button>
        </div>
    </aside>

    <!-- â•â• MAIN â•â• -->
    <main class="main-content">

        <!-- Topbar -->
        <header class="topbar">
            <div class="topbar-left">
                <button class="mobile-menu-toggle" id="mobileSidebarToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <h1 class="page-title">Dashboard</h1>
            </div>
            <div class="topbar-right">
                <button class="icon-btn" id="notificationBtn" aria-label="Notifications">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge hidden" id="notificationBadge">0</span>
                </button>
                <div class="user-menu">
                    <img src="https://ui-avatars.com/api/?name=Staff&background=6366f1&color=fff"
                         alt="User avatar" class="user-avatar" id="userAvatar">
                    <div class="user-info">
                        <span class="user-name" id="userName">Loadingâ€¦</span>
                        <span class="user-role">Staff</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Content -->
        <div class="dashboard-content">
            <div id="alertContainer"></div>

            <!-- Welcome -->
            <section class="welcome-section">
                <div class="welcome-content">
                    <h2 class="welcome-title">Welcome back, <span id="welcomeName">Staff</span>! ðŸ‘‹</h2>
                    <p class="welcome-text">Here's what's happening with your exams today.</p>
                </div>
                <div class="welcome-actions">
                    <a href="examcreate.html" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Create Exam
                    </a>
                </div>
            </section>

            <!-- â•â• STAT CARDS (5 tiles â€” last one is Live) â•â• -->
            <section class="stats-grid stats-grid-5">

                <div class="stat-card">
                    <div class="stat-icon stat-icon-primary"><i class="fas fa-file-alt"></i></div>
                    <div class="stat-content">
                        <span class="stat-label">Total Exams</span>
                        <span class="stat-value" id="totalExams"><span class="loader-dot"></span></span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon stat-icon-success"><i class="fas fa-users"></i></div>
                    <div class="stat-content">
                        <span class="stat-label">Total Students</span>
                        <span class="stat-value" id="totalStudents"><span class="loader-dot"></span></span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon stat-icon-warning"><i class="fas fa-clock"></i></div>
                    <div class="stat-content">
                        <span class="stat-label">Published Exams</span>
                        <span class="stat-value" id="activeExams"><span class="loader-dot"></span></span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon stat-icon-info"><i class="fas fa-check-circle"></i></div>
                    <div class="stat-content">
                        <span class="stat-label">Submissions Today</span>
                        <span class="stat-value" id="submissionsToday"><span class="loader-dot"></span></span>
                    </div>
                </div>

                <!-- â˜… NEW: Live Now tile -->
                <div class="stat-card stat-card-live" id="liveStatCard">
                    <div class="stat-icon stat-icon-live">
                        <span class="live-dot-sm"></span>
                        <i class="fas fa-satellite-dish"></i>
                    </div>
                    <div class="stat-content">
                        <span class="stat-label">Live Now</span>
                        <span class="stat-value" id="liveExamsCount"><span class="loader-dot"></span></span>
                    </div>
                    <!-- Clicking the tile goes to exams filtered to active -->
                    <a href="exams.html" class="stat-card-overlay-link" aria-label="View live exams"></a>
                </div>

            </section>

            <!-- â•â• MAIN GRID â•â• -->
            <div class="dashboard-grid">

                <!-- â˜… NEW: Live Monitor Widget (full width, only shown when exams are live) -->
                <section class="dashboard-card live-monitor-card" id="liveMonitorWidget" style="display:none;">
                    <div class="card-header">
                        <h3 class="card-title live-card-title">
                            <span class="live-pulse-badge">
                                <span class="lp-dot"></span> LIVE
                            </span>
                            <span>Currently Running Exams</span>
                        </h3>
                        <div class="card-header-actions">
                            <span class="live-hint"><i class="fas fa-sync-alt"></i> Auto-updates every 30s</span>
                            <button class="card-icon-btn" id="liveRefreshBtn" title="Refresh now">
                                <i class="fas fa-redo-alt"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="liveExamsList">
                            <div class="loading-state">
                                <div class="spinner"></div><p>Loading live examsâ€¦</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Recent Exams -->
                <section class="dashboard-card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-file-alt"></i> Recent Exams</h3>
                        <a href="exams.html" class="card-link">View all</a>
                    </div>
                    <div class="card-body">
                        <div id="recentExams">
                            <div class="loading-state"><div class="spinner"></div><p>Loading examsâ€¦</p></div>
                        </div>
                    </div>
                </section>

                <!-- Recent Results -->
                <section class="dashboard-card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-chart-bar"></i> Recent Submissions</h3>
                        <a href="results.html" class="card-link">View all</a>
                    </div>
                    <div class="card-body">
                        <div id="recentResults">
                            <div class="loading-state"><div class="spinner"></div><p>Loading resultsâ€¦</p></div>
                        </div>
                    </div>
                </section>

                <!-- Quick Actions â€” updated with Live Monitor -->
                <section class="dashboard-card quick-actions-card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-bolt"></i> Quick Actions</h3>
                    </div>
                    <div class="card-body">
                        <div class="quick-actions">
                            <a href="examcreate.html" class="quick-action-btn">
                                <i class="fas fa-plus-circle"></i><span>Create Exam</span>
                            </a>
                            <a href="students.html" class="quick-action-btn">
                                <i class="fas fa-user-plus"></i><span>Students</span>
                            </a>
                            <a href="results.html" class="quick-action-btn">
                                <i class="fas fa-eye"></i><span>Results</span>
                            </a>
                            <a href="analytics.html" class="quick-action-btn">
                                <i class="fas fa-chart-pie"></i><span>Analytics</span>
                            </a>
                            <!-- â˜… NEW -->
                            <a href="live-monitor.html" class="quick-action-btn quick-action-live" id="qaLiveBtn">
                                <i class="fas fa-satellite-dish"></i><span>Live Monitor</span>
                            </a>
                        </div>
                    </div>
                </section>

                <!-- Top Performers -->
                <section class="dashboard-card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-trophy"></i> Top Performers</h3>
                        <a href="students.html" class="card-link">View all</a>
                    </div>
                    <div class="card-body">
                        <div id="topStudents">
                            <div class="loading-state"><div class="spinner"></div><p>Loading studentsâ€¦</p></div>
                        </div>
                    </div>
                </section>

            </div>
        </div>
    </main>

    <script src="../../js/config.js"></script>
    <script src="../../js/api.js"></script>
    <script src="../../js/auth.js"></script>
    <script src="../../js/ui.js"></script>
    <script src="../../js/pages/staff/dashboard.js"></script>
</body>
</html>
