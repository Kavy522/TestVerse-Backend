<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exams — TestVerse Staff</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../../css/core/reset.css">
    <link rel="stylesheet" href="../../css/core/variables.css">
    <link rel="stylesheet" href="../../css/core/typography.css">
    <link rel="stylesheet" href="../../css/pages/staff/exams.css">
</head>
<body>
<div class="dashboard-layout">

    <!-- ══ SIDEBAR ══ -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <a href="dashboard.html" class="logo">
                <i class="fas fa-graduation-cap"></i>
                <span>TestVerse</span>
            </a>
            <button class="sidebar-toggle" id="sidebarClose"><i class="fas fa-times"></i></button>
        </div>
        <nav class="sidebar-nav">
            <a href="dashboard.html" class="nav-item"><i class="fas fa-home"></i><span>Dashboard</span></a>
            <a href="exams.html"     class="nav-item active"><i class="fas fa-file-alt"></i><span>Exams</span></a>
            <a href="students.html"  class="nav-item"><i class="fas fa-users"></i><span>Students</span></a>
            <a href="results.html"   class="nav-item"><i class="fas fa-chart-bar"></i><span>Results</span></a>
            <a href="analytics.html" class="nav-item"><i class="fas fa-chart-line"></i><span>Analytics</span></a>
            <a href="settings.html"  class="nav-item"><i class="fas fa-cog"></i><span>Settings</span></a>
        </nav>
        <div class="sidebar-footer">
            <div class="user-card">
                <img id="sidebarAvatar" src="" alt="Avatar" class="user-card-avatar">
                <div>
                    <span class="user-card-name" id="sidebarName">Staff</span>
                    <span class="user-card-role">Staff Member</span>
                </div>
            </div>
            <button class="nav-item logout-btn" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i><span>Logout</span>
            </button>
        </div>
    </aside>
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- ══ MAIN ══ -->
    <div class="main-content">
        <header class="topbar">
            <div class="topbar-left">
                <button class="mobile-menu-toggle" id="menuToggle"><i class="fas fa-bars"></i></button>
                <div class="breadcrumb">
                    <span class="breadcrumb-item">Staff</span>
                    <i class="fas fa-chevron-right breadcrumb-sep"></i>
                    <span class="breadcrumb-item active">Exams</span>
                </div>
            </div>
            <div class="topbar-right">
                <button class="icon-btn" id="refreshBtn" title="Refresh">
                    <i class="fas fa-sync-alt"></i>
                </button>
                <div class="user-menu">
                    <img id="topbarAvatar" src="" alt="" class="user-avatar">
                    <div>
                        <div class="user-name" id="topbarName">Staff</div>
                        <div class="user-role">Staff Member</div>
                    </div>
                </div>
            </div>
        </header>

        <main class="page-content">
            <div id="alertContainer" class="alert-container"></div>

            <!-- Page Header -->
            <div class="page-header">
                <div class="page-header-left">
                    <h1 class="page-title">Exams</h1>
                    <p class="page-subtitle">Manage, schedule and publish your assessments</p>
                </div>
                <a href="examcreate.html" class="btn btn-primary">
                    <i class="fas fa-plus"></i> New Exam
                </a>
            </div>

            <!-- Stat Pills -->
            <div class="stats-row">
                <div class="stat-pill" data-filter=""><div class="stat-pill-icon all"><i class="fas fa-layer-group"></i></div><div class="stat-pill-body"><span class="stat-pill-val" id="statAll">—</span><span class="stat-pill-lbl">All Exams</span></div></div>
                <div class="stat-pill" data-filter="draft"><div class="stat-pill-icon draft"><i class="fas fa-pencil-alt"></i></div><div class="stat-pill-body"><span class="stat-pill-val" id="statDraft">—</span><span class="stat-pill-lbl">Drafts</span></div></div>
                <div class="stat-pill" data-filter="published"><div class="stat-pill-icon published"><i class="fas fa-check-circle"></i></div><div class="stat-pill-body"><span class="stat-pill-val" id="statPublished">—</span><span class="stat-pill-lbl">Published</span></div></div>
                <div class="stat-pill" data-filter="active"><div class="stat-pill-icon active"><i class="fas fa-broadcast-tower"></i></div><div class="stat-pill-body"><span class="stat-pill-val" id="statActive">—</span><span class="stat-pill-lbl">Live Now</span></div></div>
                <div class="stat-pill" data-filter="completed"><div class="stat-pill-icon completed"><i class="fas fa-flag-checkered"></i></div><div class="stat-pill-body"><span class="stat-pill-val" id="statCompleted">—</span><span class="stat-pill-lbl">Completed</span></div></div>
            </div>

            <!-- Filter Bar -->
            <div class="filter-bar">
                <div class="search-wrap">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="searchInput" class="search-input" placeholder="Search exams by title…" autocomplete="off">
                    <button class="search-clear hidden" id="searchClear"><i class="fas fa-times"></i></button>
                </div>
                <div class="filter-selects">
                    <!-- FIX: synced with examcreate.html (mcq/mixed/descriptive/coding) -->
                    <select id="typeFilter" class="filter-select">
                        <option value="">All Types</option>
                        <option value="mcq">MCQ Only</option>
                        <option value="mixed">Mixed</option>
                        <option value="descriptive">Descriptive</option>
                        <option value="coding">Coding</option>
                    </select>
                    <select id="sortFilter" class="filter-select">
                        <option value="-created_at">Newest First</option>
                        <option value="created_at">Oldest First</option>
                        <option value="title">Title A–Z</option>
                        <option value="-title">Title Z–A</option>
                        <option value="start_time">Start Date ↑</option>
                        <option value="-start_time">Start Date ↓</option>
                    </select>
                </div>
            </div>

            <!-- Results Info -->
            <div class="results-info" id="resultsInfo" style="display:none;">
                <span id="resultsText"></span>
                <button class="clear-filters-btn hidden" id="clearFiltersBtn"><i class="fas fa-times-circle"></i> Clear filters</button>
            </div>

            <!-- States -->
            <div class="loading-state" id="loadingState"><div class="spinner"></div><p>Loading exams…</p></div>
            <div class="empty-state" id="emptyState" style="display:none;">
                <div class="empty-icon"><i class="fas fa-file-alt"></i></div>
                <h3 id="emptyTitle">No Exams Yet</h3>
                <p id="emptySubtitle">Create your first exam to get started.</p>
                <a href="examcreate.html" class="btn btn-primary" id="emptyAction" style="margin-top:0.5rem;"><i class="fas fa-plus"></i> Create First Exam</a>
            </div>

            <!-- Grid -->
            <div class="exams-grid" id="examsGrid" style="display:none;"></div>

            <!-- Pagination -->
            <div class="pagination" id="pagination" style="display:none;">
                <button class="page-btn" id="prevBtn" disabled><i class="fas fa-chevron-left"></i> Prev</button>
                <span class="page-info" id="pageInfo">Page 1 of 1</span>
                <button class="page-btn" id="nextBtn" disabled>Next <i class="fas fa-chevron-right"></i></button>
            </div>
        </main>
    </div>
</div>

<!-- ══ EDIT MODAL ══ -->
<div class="modal" id="editModal">
    <div class="modal-dialog modal-lg">
        <div class="modal-header">
            <h2 class="modal-title"><i class="fas fa-edit"></i> Edit Exam</h2>
            <button class="modal-close" id="editModalClose"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body">
            <div id="editAlertContainer"></div>
            <form id="editForm" novalidate>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Title <span class="form-required">*</span></label>
                        <input type="text" id="editTitle" class="form-input" placeholder="e.g. Midterm Exam 2026" required>
                        <span class="form-error" id="editTitleErr"></span>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Exam Type <span class="form-required">*</span></label>
                        <!-- FIX: synced with examcreate.html (mcq/mixed/descriptive/coding) -->
                        <select id="editType" class="form-input" required>
                            <option value="mcq">MCQ Only</option>
                            <option value="mixed">Mixed</option>
                            <option value="descriptive">Descriptive</option>
                            <option value="coding">Coding</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Description <span class="form-required">*</span></label>
                    <textarea id="editDescription" class="form-input form-textarea" rows="3" placeholder="Brief description…" required></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Start Time <span class="form-required">*</span></label>
                        <input type="datetime-local" id="editStart" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">End Time <span class="form-required">*</span></label>
                        <input type="datetime-local" id="editEnd" class="form-input" required>
                    </div>
                </div>
                <div class="form-row form-row-3">
                    <div class="form-group">
                        <label class="form-label">Duration (min)</label>
                        <input type="number" id="editDuration" class="form-input" placeholder="Auto" disabled>
                        <span class="form-hint">Auto-calculated</span>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Total Marks <span class="form-required">*</span></label>
                        <input type="number" id="editTotalMarks" class="form-input" placeholder="100" min="1" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Passing Marks <span class="form-required">*</span></label>
                        <input type="number" id="editPassMarks" class="form-input" placeholder="40" min="1" required>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Instructions</label>
                    <textarea id="editInstructions" class="form-input form-textarea" rows="3" placeholder="Special instructions for students…"></textarea>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-outline" id="editCancelBtn">Cancel</button>
            <button class="btn btn-primary" id="editSaveBtn">
                <span class="btn-text"><i class="fas fa-save"></i> Save Changes</span>
                <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i> Saving…</span>
            </button>
        </div>
    </div>
</div>

<!-- ══ DELETE MODAL ══ -->
<div class="modal" id="deleteModal">
    <div class="modal-dialog modal-sm">
        <div class="modal-header">
            <h2 class="modal-title danger"><i class="fas fa-trash"></i> Delete Exam</h2>
            <button class="modal-close" id="deleteModalClose"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body">
            <div class="danger-box">
                <i class="fas fa-exclamation-triangle"></i>
                <div>
                    <p>You are about to permanently delete <strong id="deleteExamName"></strong>.</p>
                    <p class="danger-note">All questions and student results will be removed. This cannot be undone.</p>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-outline" id="deleteCancelBtn">Cancel</button>
            <button class="btn btn-danger" id="deleteConfirmBtn">
                <span class="btn-text"><i class="fas fa-trash"></i> Delete Forever</span>
                <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i> Deleting…</span>
            </button>
        </div>
    </div>
</div>

<!-- ══ PUBLISH MODAL ══ -->
<div class="modal" id="publishModal">
    <div class="modal-dialog modal-sm">
        <div class="modal-header">
            <h2 class="modal-title" id="publishModalTitle"><i class="fas fa-check-circle"></i> Publish Exam</h2>
            <button class="modal-close" id="publishModalClose"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body"><p id="publishModalMsg"></p></div>
        <div class="modal-footer">
            <button class="btn btn-outline" id="publishCancelBtn">Cancel</button>
            <!-- FIX: btn-text + btn-loader spans preserved; JS uses classList not className= -->
            <button class="btn btn-primary" id="publishConfirmBtn">
                <span class="btn-text" id="publishConfirmText">Confirm</span>
                <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i></span>
            </button>
        </div>
    </div>
</div>

<script src="../../js/config.js"></script>
<script src="../../js/api.js"></script>
<script src="../../js/auth.js"></script>
<script src="../../js/ui.js"></script>
<script src="../../js/pages/staff/exams.js"></script>
</body>
</html>
