<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics | TestVerse</title>

    <link rel="icon" href="../../assets/icons/exam.svg" type="image/svg+xml">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Core -->
    <link rel="stylesheet" href="../../css/core/reset.css">
    <link rel="stylesheet" href="../../css/core/variables.css">
    <link rel="stylesheet" href="../../css/core/typography.css">
    <link rel="stylesheet" href="../../css/core/layout.css">

    <!-- Components -->
    <link rel="stylesheet" href="../../css/components/buttons.css">
    <link rel="stylesheet" href="../../css/components/cards.css">
    <link rel="stylesheet" href="../../css/components/badges.css">

    <!-- Page -->
    <link rel="stylesheet" href="../../css/pages/student/analytics.css">
</head>
<body class="dashboard-layout">

    <!-- ══ SIDEBAR ══════════════════════════════════════════════════ -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <a href="../../index.html" class="logo">
                <i class="fas fa-graduation-cap"></i>
                <span class="logo-text">TestVerse</span>
            </a>
        </div>
        <nav class="sidebar-nav">
            <a href="dashboard.html"   class="nav-item"><i class="fas fa-home"></i><span>Dashboard</span></a>
            <a href="exams.html"       class="nav-item"><i class="fas fa-file-alt"></i><span>Exams</span></a>
            <a href="results.html"     class="nav-item"><i class="fas fa-chart-bar"></i><span>My Results</span></a>
            <a href="leaderboard.html" class="nav-item"><i class="fas fa-trophy"></i><span>Leaderboard</span></a>
            <a href="analytics.html"   class="nav-item active"><i class="fas fa-chart-line"></i><span>Analytics</span></a>
            <a href="profile.html"     class="nav-item"><i class="fas fa-user-circle"></i><span>Profile</span></a>
        </nav>
        <div class="sidebar-footer">
            <div class="sidebar-user-card">
                <img src="https://ui-avatars.com/api/?name=Student&background=6366f1&color=fff"
                     alt="Avatar" class="su-avatar" id="sidebarAvatar">
                <div class="su-info">
                    <span class="su-name" id="sidebarName">Loading…</span>
                    <span class="su-role">Student</span>
                </div>
            </div>
            <button class="nav-item logout-btn" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i><span>Logout</span>
            </button>
        </div>
    </aside>
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- ══ MAIN CONTENT ══════════════════════════════════════════════ -->
    <main class="main-content">

        <!-- Topbar -->
        <header class="topbar">
            <div class="topbar-left">
                <button class="mobile-menu-toggle" id="mobileSidebarToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <div>
                    <h1 class="page-title">Analytics</h1>
                    <p class="page-subtitle" id="analyticsSubtitle">Your performance overview</p>
                </div>
            </div>
            <div class="topbar-right">
                <select class="period-select" id="periodSelect">
                    <option value="all">All Time</option>
                    <option value="30">Last 30 Days</option>
                    <option value="90">Last 90 Days</option>
                    <option value="7">Last 7 Days</option>
                </select>
                <button class="icon-btn" id="refreshBtn" title="Refresh data">
                    <i class="fas fa-sync-alt"></i>
                </button>
                <button class="icon-btn" id="notificationBtn">
                    <i class="fas fa-bell"></i>
                    <span class="notif-badge hidden" id="notifBadge">0</span>
                </button>
                <div class="user-menu">
                    <img src="https://ui-avatars.com/api/?name=Student&background=6366f1&color=fff"
                         alt="Avatar" class="user-avatar" id="topbarAvatar">
                    <div class="user-info">
                        <span class="user-name" id="topbarName">Loading…</span>
                        <span class="user-role">Student</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Page Content -->
        <div class="page-content">

            <!-- ── TOP KPI CARDS ──────────────────────────────────── -->
            <section class="kpi-grid" id="kpiGrid">
                <!-- Rendered by JS -->
                <div class="kpi-card shimmer-card"></div>
                <div class="kpi-card shimmer-card"></div>
                <div class="kpi-card shimmer-card"></div>
                <div class="kpi-card shimmer-card"></div>
                <div class="kpi-card shimmer-card"></div>
            </section>

            <!-- ── ROW 1: Score Trend + Pass/Fail Donut ───────────── -->
            <div class="analytics-row">

                <!-- Score Trend (SVG sparkline) -->
                <div class="an-card an-card-lg">
                    <div class="an-card-header">
                        <div>
                            <h3 class="an-card-title"><i class="fas fa-chart-line"></i> Score Trend</h3>
                            <p class="an-card-sub">Your score across all exams over time</p>
                        </div>
                        <div class="an-card-actions">
                            <button class="an-tab-btn active" data-chart="trend-line">Line</button>
                            <button class="an-tab-btn" data-chart="trend-bar">Bar</button>
                        </div>
                    </div>
                    <div class="an-chart-wrap" id="trendChartWrap">
                        <div class="chart-loading" id="trendLoading">
                            <div class="spinner-sm"></div><span>Loading…</span>
                        </div>
                        <svg id="trendChart" class="trend-svg hidden" preserveAspectRatio="none"></svg>
                        <div class="trend-empty hidden" id="trendEmpty">
                            <i class="fas fa-chart-line"></i>
                            <span>Attempt more exams to see your trend</span>
                        </div>
                    </div>
                    <!-- X-axis labels -->
                    <div class="trend-labels" id="trendLabels"></div>
                </div>

                <!-- Pass/Fail Donut -->
                <div class="an-card an-card-sm">
                    <div class="an-card-header">
                        <div>
                            <h3 class="an-card-title"><i class="fas fa-chart-pie"></i> Pass / Fail</h3>
                            <p class="an-card-sub">Overall result distribution</p>
                        </div>
                    </div>
                    <div class="donut-wrap" id="donutWrap">
                        <div class="chart-loading" id="donutLoading">
                            <div class="spinner-sm"></div><span>Loading…</span>
                        </div>
                        <div class="donut-chart hidden" id="donutChart">
                            <svg viewBox="0 0 120 120" width="140" height="140">
                                <!-- Pass arc -->
                                <circle id="donutPass"  class="donut-seg pass"   cx="60" cy="60" r="50"
                                        stroke-dasharray="0 314.16" stroke-dashoffset="0"/>
                                <!-- Fail arc -->
                                <circle id="donutFail"  class="donut-seg fail"   cx="60" cy="60" r="50"
                                        stroke-dasharray="0 314.16" stroke-dashoffset="0"/>
                                <!-- Pending arc -->
                                <circle id="donutPend"  class="donut-seg pend"   cx="60" cy="60" r="50"
                                        stroke-dasharray="0 314.16" stroke-dashoffset="0"/>
                                <!-- Track -->
                                <circle class="donut-track" cx="60" cy="60" r="50"/>
                            </svg>
                            <div class="donut-center">
                                <span class="donut-pct"  id="donutPct">0%</span>
                                <span class="donut-label">Pass Rate</span>
                            </div>
                        </div>
                        <div class="donut-legend" id="donutLegend"></div>
                    </div>
                </div>

            </div><!-- /row1 -->

            <!-- ── ROW 2: Subject Breakdown + Time Analysis ───────── -->
            <div class="analytics-row">

                <!-- Subject / Category Breakdown -->
                <div class="an-card an-card-md">
                    <div class="an-card-header">
                        <div>
                            <h3 class="an-card-title"><i class="fas fa-layer-group"></i> Subject Breakdown</h3>
                            <p class="an-card-sub">Average score by subject / category</p>
                        </div>
                    </div>
                    <div id="subjectBars" class="subject-bars">
                        <div class="chart-loading" id="subjectLoading">
                            <div class="spinner-sm"></div><span>Loading…</span>
                        </div>
                    </div>
                </div>

                <!-- Time per Exam -->
                <div class="an-card an-card-md">
                    <div class="an-card-header">
                        <div>
                            <h3 class="an-card-title"><i class="fas fa-stopwatch"></i> Time Taken</h3>
                            <p class="an-card-sub">Time used vs allowed per exam</p>
                        </div>
                    </div>
                    <div id="timeBars" class="time-bars">
                        <div class="chart-loading" id="timeLoading">
                            <div class="spinner-sm"></div><span>Loading…</span>
                        </div>
                    </div>
                </div>

            </div><!-- /row2 -->

            <!-- ── ROW 3: Exam-type Breakdown + Badges + Activity ─── -->
            <div class="analytics-row analytics-row-3">

                <!-- Exam Type Distribution (horizontal bars) -->
                <div class="an-card">
                    <div class="an-card-header">
                        <div>
                            <h3 class="an-card-title"><i class="fas fa-tags"></i> Exam Types</h3>
                            <p class="an-card-sub">Attempts by exam type</p>
                        </div>
                    </div>
                    <div id="typeBreakdown" class="type-breakdown">
                        <div class="chart-loading" id="typeLoading">
                            <div class="spinner-sm"></div><span>Loading…</span>
                        </div>
                    </div>
                </div>

                <!-- Badges earned -->
                <div class="an-card">
                    <div class="an-card-header">
                        <div>
                            <h3 class="an-card-title"><i class="fas fa-medal"></i> Badges Earned</h3>
                            <p class="an-card-sub">Achievements unlocked</p>
                        </div>
                        <span class="badge-count-chip" id="badgeCountChip">—</span>
                    </div>
                    <div id="badgesWrap" class="badges-wrap">
                        <div class="chart-loading" id="badgesLoading">
                            <div class="spinner-sm"></div><span>Loading…</span>
                        </div>
                    </div>
                </div>

                <!-- Points / Streaks -->
                <div class="an-card">
                    <div class="an-card-header">
                        <div>
                            <h3 class="an-card-title"><i class="fas fa-fire"></i> Points & Streaks</h3>
                            <p class="an-card-sub">Gamification progress</p>
                        </div>
                    </div>
                    <div id="pointsWrap" class="points-wrap">
                        <div class="chart-loading" id="pointsLoading">
                            <div class="spinner-sm"></div><span>Loading…</span>
                        </div>
                    </div>
                </div>

            </div><!-- /row3 -->

            <!-- ── ROW 4: Recent Activity Table ───────────────────── -->
            <div class="an-card an-card-full">
                <div class="an-card-header">
                    <div>
                        <h3 class="an-card-title"><i class="fas fa-list-alt"></i> Recent Attempts</h3>
                        <p class="an-card-sub">Last 10 exam attempts with performance breakdown</p>
                    </div>
                    <a href="results.html" class="btn-link">View All Results <i class="fas fa-arrow-right"></i></a>
                </div>
                <div class="attempts-table-wrap" id="attemptsTableWrap">
                    <div class="chart-loading" id="attemptsLoading">
                        <div class="spinner-sm"></div><span>Loading…</span>
                    </div>
                </div>
            </div>

        </div><!-- /page-content -->
    </main>

    <script src="../../js/config.js"></script>
    <script src="../../js/api.js"></script>
    <script src="../../js/auth.js"></script>
    <script src="../../js/pages/student/analytics.js"></script>
</body>
</html>
